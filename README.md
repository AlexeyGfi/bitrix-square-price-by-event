# bitrix-square-price-by-event
CMS Битрикс. Заполнение и обновление цены за метр квадратный в реакцию на изменение основной цены.

## Общая схема работы:
- метод класса `onPriceEvent` реагирует на событие изменения цены `OnPriceUpdate`;
- если выполняются условия, заряжаем данные в стек измений. Мы не можем сразу же вносить изменения, потому что ещё не отработало текущее событие (на которое мы отреагировали); кроме того, событие изменения цены — не одиночное, а как правило идёт серией — отдельно по каждому товару и по каждому типу цены в карточке товаре;
- в процессе накапливания стека, класс подписывает себя на событие `OnBeforeEndBufferContent`. Чтобы разобрать стек изменений тогда, когда уже все остальные события по ценам отработают;
- реагируем на финализирующее событие и разбираем стек.

## Подписывание на событие изменение цены:
В файле **init.php** подписываем наш класс на событие:
```
$eventManager->addEventHandler('catalog', 'OnPriceUpdate', 
[\GitHub\SquareMettersPrices::class, 'onPriceEvent']);
```

## Class GitHub not found
Один из способов обеспечить видимость класса (чтобы срабатывала автоподгрузка) — объявить неймспейс:
```
\Bitrix\Main\Loader::registerNamespace(
    'GitHub',
    $server->getDocumentRoot() . '/local/lib/GitHub'
);
```
